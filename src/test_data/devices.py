import json

iphone = {
    "msg": None,
    "activationLocked": True,
    "passcodeLength": 6,
    "features": {

    },
    "scd": False,
    "id": "TESTIPHONE0",
    "remoteLock": None,
    "rm2State": 0,
    "modelDisplayName": "iPhone",
    "repairStatus": None,
    "fmlyShare": False,
    "pendingRemoveUntilTS": 0,
    "repairReadyExpireTS": 0,
    "repairReady": False,
    "lostModeCapable": True,
    "wipedTimestamp": None,
    "encodedDeviceId": None,
    "scdPh": "",
    "locationCapable": True,
    "trackingInfo": None,
    "name": "iPhone",
    "isMac": False,
    "thisDevice": False,
    "deviceClass": "iPhone",
    "nwd": False,
    "remoteWipe": None,
    "canWipeAfterLock": True,
    "baUUID": "00000-0000-0000-0000-TESTIPHONE0",
    "lostModeEnabled": False,
    "wipeInProgress": False,
    "repairDeviceReason": "",
    "deviceStatus": "200",
    "deviceColor": "1-6-0",
    "tlStatusLastUpdatedTS": 0,
    "tlStatus": "",
    "repairState": None,
    "isConsideredAccessory": False,
    "deviceWithYou": False,
    "useTLR": False,
    "lowPowerMode": False,
    "rawDeviceModel": "iPhone14,6",
    "deviceDiscoveryId": "00000-0000-0000-0000-TESTIPHONE0",
    "isLocating": True,
    "lostTimestamp": "",
    "mesg": None,
    "batteryLevel": 0.14000000059604645,
    "locationEnabled": True,
    "lockedTimestamp": None,
    "locFoundEnabled": False,
    "snd": None,
    "lostDevice": None,
    "deviceDisplayName": "iPhone SE",
    "prsId": None,
    "audioChannels": [],
    "batteryStatus": "NotCharging",
    "pendingRemove": False,
    "location": {
        "isOld": False,
        "isInaccurate": False,
        "altitude": 0.0,
        "addresses": None,
        "positionType": "Wifi",
        "secureLocation": None,
        "secureLocationTs": 0,
        "latitude": 0,
        "floorLevel": 0,
        "horizontalAccuracy": 0,
        "locationType": "",
        "timeStamp": 1735660800,
        "locationFinished": True,
        "verticalAccuracy": 0.0,
        "locationMode": None,
        "longitude": 100
    },
    "deviceModel": "iphone13-1-6-0",
    "maxMsgChar": 160,
    "darkWake": False
}
apple_watch = {
    "msg": {
        "strobe": False,
        "userText": True,
        "playSound": False,
        "vibrate": False,
        "createTimestamp": 1735660800,
        "statusCode": "205"
    },
    "activationLocked": False,
    "passcodeLength": 4,
    "features": {

    },
    "scd": False,
    "id": "TESTWATCH0",
    "remoteLock": None,
    "rm2State": 0,
    "modelDisplayName": "Apple Watch",
    "repairStatus": None,
    "fmlyShare": True,
    "pendingRemoveUntilTS": 0,
    "repairReadyExpireTS": 0,
    "repairReady": False,
    "lostModeCapable": True,
    "wipedTimestamp": None,
    "encodedDeviceId": None,
    "scdPh": "",
    "locationCapable": True,
    "trackingInfo": None,
    "name": "Apple Watch Name",
    "isMac": False,
    "thisDevice": False,
    "deviceClass": "Watch",
    "nwd": False,
    "remoteWipe": None,
    "canWipeAfterLock": True,
    "lostModeEnabled": False,
    "wipeInProgress": False,
    "repairDeviceReason": "",
    "deviceStatus": "203",
    "deviceColor": "1-2-0",
    "tlStatusLastUpdatedTS": 0,
    "tlStatus": "",
    "repairState": None,
    "isConsideredAccessory": False,
    "deviceWithYou": False,
    "useTLR": False,
    "lowPowerMode": False,
    "rawDeviceModel": "Watch6,6",
    "isLocating": False,
    "lostTimestamp": "",
    "batteryLevel": 0.0,
    "locationEnabled": True,
    "lockedTimestamp": None,
    "locFoundEnabled": False,
    "snd": None,
    "lostDevice": None,
    "deviceDisplayName": "Apple Watch Series 7 (GPS)",
    "prsId": None,
    "audioChannels": [],
    "batteryStatus": "Unknown",
    "pendingRemove": False,
    "location": None,
    "deviceModel": "Watch6_6-1-2-0",
    "maxMsgChar": 70,
    "darkWake": False
}
ipad = {
    "msg": None,
    "activationLocked": True,
    "passcodeLength": 6,
    "features": {

    },
    "scd": False,
    "id": "TESTIPAD0",
    "remoteLock": None,
    "rm2State": 0,
    "modelDisplayName": "iPad",
    "repairStatus": None,
    "fmlyShare": False,
    "pendingRemoveUntilTS": 0,
    "repairReadyExpireTS": 0,
    "repairReady": False,
    "lostModeCapable": True,
    "wipedTimestamp": None,
    "encodedDeviceId": None,
    "scdPh": "",
    "locationCapable": True,
    "trackingInfo": None,
    "name": "iPad Name",
    "isMac": False,
    "thisDevice": False,
    "deviceClass": "iPad",
    "nwd": False,
    "remoteWipe": None,
    "canWipeAfterLock": True,
    "baUUID": "",
    "lostModeEnabled": False,
    "wipeInProgress": False,
    "repairDeviceReason": "",
    "deviceStatus": "200",
    "deviceColor": "3b3b3c-99989b",
    "tlStatusLastUpdatedTS": 0,
    "tlStatus": "",
    "repairState": None,
    "isConsideredAccessory": False,
    "deviceWithYou": False,
    "useTLR": False,
    "lowPowerMode": False,
    "rawDeviceModel": "iPad4,4",
    "isLocating": True,
    "lostTimestamp": "",
    "mesg": None,
    "batteryLevel": 0.41999998688697815,
    "locationEnabled": True,
    "lockedTimestamp": None,
    "locFoundEnabled": False,
    "snd": None,
    "lostDevice": None,
    "deviceDisplayName": "iPad mini",
    "prsId": None,
    "audioChannels": [],
    "batteryStatus": "NotCharging",
    "pendingRemove": False,
    "location": {
        "isOld": False,
        "isInaccurate": False,
        "altitude": 0.0,
        "addresses": None,
        "positionType": "Wifi",
        "secureLocation": None,
        "secureLocationTs": 0,
        "latitude": 0,
        "floorLevel": 0,
        "horizontalAccuracy": 65.0,
        "locationType": "",
        "timeStamp": 1735660800,
        "locationFinished": False,
        "verticalAccuracy": 0.0,
        "locationMode": None,
        "longitude": 100
    },
    "deviceModel": "SecondGen-3b3b3c-99989b",
    "maxMsgChar": 160,
    "darkWake": False
}


class TestDevice:
    """Test device Data."""

    def __init__(
            self,
            raw_data
    ):
        self.content = raw_data

    def update(self, data):
        """Updates the device data."""
        self.content = data
        print(f"[DEBUG] Device {self.content['name']} data updated.")

    def location(self):
        """Updates the device location."""
        print(f"[DEBUG] Device {self.content['name']} location updated.")
        # Do something to refresh the location data.
        return self.content["location"]

    def status(self, additional=[]):  # pylint: disable=dangerous-default-value
        """Returns status information for device.

        This returns only a subset of possible properties.
        """
        self.manager.refresh_client()
        fields = ["batteryLevel", "deviceDisplayName", "deviceStatus", "name"]
        fields += additional
        properties = {}
        for field in fields:
            properties[field] = self.content.get(field)
        return properties

    def play_sound(self, subject="Find My iPhone Alert"):
        """Send a request to the device to play a sound.

        It's possible to pass a custom message by changing the `subject`.
        """
        data = json.dumps(
            {
                "device": self.content["id"],
                "subject": subject,
                "clientContext": {"fmly": True},
            }
        )
        print(f"[DEBUG] Sending sound request to {self.content['name']}:\n{data}")

    def display_message(
            self, subject="Find My iPhone Alert", message="This is a note", sounds=False
    ):
        """Send a request to the device to play a sound.

        It's possible to pass a custom message by changing the `subject`.
        """
        data = json.dumps(
            {
                "device": self.content["id"],
                "subject": subject,
                "sound": sounds,
                "userText": True,
                "text": message,
            }
        )
        print(f"[DEBUG] Sending message to {self.content['name']}:\n{data}")

    def lost_device(
            self, number, text="This iPhone has been lost. Please call me.", newpasscode=""
    ):
        """Send a request to the device to trigger 'lost mode'.

        The device will show the message in `text`, and if a number has
        been passed, then the person holding the device can call
        the number without entering the passcode.
        """
        data = json.dumps(
            {
                "text": text,
                "userText": True,
                "ownerNbr": number,
                "lostModeEnabled": True,
                "trackingEnabled": True,
                "device": self.content["id"],
                "passcode": newpasscode,
            }
        )
        print(f"[DEBUG] Sending lost device request to {self.content['name']}:\n{data}")

    @property
    def data(self):
        """Gets the device data."""
        return self.content

    def __getitem__(self, key):
        return self.content[key]

    def __getattr__(self, attr):
        return getattr(self.content, attr)

    def __str__(self):
        return f"{self['deviceDisplayName']}: {self['name']}"

    def __repr__(self):
        return f"<TestDevice({self})>"


test_devices = {"TESTIPHONE0": TestDevice(iphone), "TESTWATCH0": TestDevice(apple_watch),
                "TESTIPAD0": TestDevice(ipad)}
